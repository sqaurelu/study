# 순회와 이터레이션 프로토콜

> 추가할 자료 링크
>- [Iteration protocols - MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/Spread_syntax)
>- [for...of - MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/for...of)

## 순회

JS에서 Array, Map, Set, String, TypedArray, arguments 객체 등은 순회가 가능하다. es6 이전에는 `for (var i = 0; i < arr.length; i++)...`
같은 형태로 순회했다.

```javascript
// es5
const list = [1, 2, 3, 4];
for (var i = 0; i < list.length; i++) {
  console.log(list[i]);
}

const str = 'abcd'; // 유사 배열
for (var i = 0; i < str.length; i++) {
  console.log(str[i]);
}
```

es6부터는 `for...of`를 이용해 반복 가능한 객체를 순회할 수 있다.

```javascript
// es6
for (const a of list) {
  console.log(a);
}
for (const a of str) {
  console.log(a);
}
```

## iteration protocol

- 이터러블: 이터레이터를 리턴하는 `[Symbol.iterator]()`를 가진 값
  ```javascript
  const arr = [1, 2, 3, 4]; // -> arr(배열)은 iterable이다.
  
  arr[Symbol.iterator] = null; // iterable 값을 null로 지우면 
  for (const a of arr) { 
    console.log(a); // Uncaught TypeError: arr is not iterable
  }
  ```
- 이터레이터: `{ value, done }` 객체를 리턴하는 `next()`를 가진 값

  ```javascript
  const iterator = arr[Symbol.iterator](); // 이터레이터
  
  console.log(iterator.next()); // {value: 1, done: false}
  ```

- 이터러블/이터레이터 프로토콜: 이터러블을 `for...of`, 전개 연산자 등과 함께 동작하도록한 규약
  - `for...of` -> 이터레이터의 `next()`가 반환하는 `value` 값을 변수로 넘겨주고, `done`이 `true`가 되면 `for`문 종료

> `Symbol`은 es6에서 추가된 것. 어떤 객체의 키로 사용될 수 있다.

_배열은 인덱스를 통해 원소에 접근 가능하지만, `Set`, `Map`은 인덱스로 원소 접근 불가능하다._

## `Array`, `Set`, `Map`

JS의 내장 객체로 iterable, iterator 프로토콜을 따르고 있다.

### Array

```javascript
const arr = [1, 2, 3, 4];
for (const a of arr) {
  console.log(a);
}
```

### Set

```javascript
const set = new Set([1, 2, 3, 4]);
for (const a of set) {
  console.log(a);
}
```

### Map

```javascript
const map = new Map([['a', 1], ['b', 2], ['c', 3], ['d', 4]]);
for (const a of map) {
  console.log(a);
}
```

- `map.keys()`

  ```javascript
  for (const a of map.keys()) { // map.keys(): value에 map의 key 값만 담기는 이터레이터
    console.log(a);
  }
  
  const iterator = map.keys();
  console.log(iterator.next()); // {value: 'a', done: false}
  ```

- `map.values()`

  ```javascript
  for (const a of map.values()) { // map.keys(): value에 map의 value 값만 담기는 이터레이터
    console.log(a);
  }
  
  const iterator = map.values();
  console.log(iterator.next()); // {value: 1, done: false}
  ```

- `map.entries()`

  ```javascript
  for (const a of map.entries()) { // map.keys(): value에 map의 key, value 모두 담기는 이터레이터
    console.log(a);
  }
  
  const iterator = map.entries();
  console.log(iterator.next()); // {value: ['a', 1], done: false}
  ```

## 사용자 정의 이터러블

잘 구현된 이터러블

- 이터레이터를 만들었을 때 이터레이터를 진행(`next()` 호출)하다가 순회할 수도 있다.
- 이터레이터를 `for...of`문에 넣어도 모든 값을 순회한다.

  ```javascript
  const arr = [1, 2, 3, 4];
  
  const iterator = arr[Symbol.iterator]();
  
  iterator().next(); // 1
  for (const a of arr) console.log(a); // 2, 3, 4
  
  for (const a of iterator) consoel.log(a); //2, 3, 4
  ```

- 이터레이터가 자기 자신을 반환하는 `Symbol.iterator` 메서드를 가지고 있을 때 well-formed iterable/iterator

  ```javascript
  const arr = [1, 2, 3, 4];
  
  const iterator = arr[Symbol.iterator]();
  
  // arr(iterable)이 반환한 iterator도 Symbol.iterator가 있다.
  const iterator2 = iterator[Symbol.iterator]();
  console.log(iterator2 === iterator2[Symbol.iterator]()); // true -> 자기 자신을 반환 
  ```

만들어보기

```javascript
const iterable = {
  [Symbol.iterator]() {
    let i = 3;
    return {
      next() {
        return i === 0 ? { done: true } : { value: i--, done: false };
      },
      [Symbol.iterator]() {
        return this;
      } // 이게 없으면 TypeError: iterator is not iterable
    }
  }
};

for (const a of iterable) console.log(a);

const iterator = iterable[Symbol.iterator]();
for (const a of iterator) console.log(a);
```

## spread operator

spread operator도 iterable, iterator 프로토콜을 따르고 있다.

```javascript
const arr = [1, 2, 3, 4];
console.log(...arr); // 1, 2, 3, 4

arr[Symbol.iterator] = null;
console.log([...arr]); // Uncaught TypeError: arr is not iterable
```

# reference

- https://github.com/indongyoo/functional-javascript-01